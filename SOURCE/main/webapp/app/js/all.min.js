var gabblerApp=angular.module("gabblerApp",["ngRoute","ngAnimate","gabbler.translate","gabbler.login.service","gabbler.menu","gabbler.login","gabbler.register.service","gabbler.register","gabbler.home","gabbler.timeline","gabbler.profile.service","gabbler.profile"]);gabblerApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"/main/webapp/app/js/modules/index/home.html",controller:"indexCtrl"}),e.when("/timeline",{templateUrl:"/main/webapp/app/js/modules/timeline/timeline.html"}),e.when("/profile",{templateUrl:"/main/webapp/app/js/modules/profile/profile.html",controller:"profileCtrl"})}]).run(["$http",function(e){e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"x-requested-with"}}]),angular.module("gabbler.home",["gabbler.menu","gabbler.login","gabbler.register"]).controller("indexCtrl",["$scope","AuthenticationService",function(e,t){e.pageClass="indexPageClass",t.ClearCredentials()}]),angular.module("gabbler.login",[]).controller("loginCtrl",["$scope","$rootScope","$cookieStore","$location","AuthenticationService","$route",function(e,t,r,n,o){e.login=function(){e.dataLoading=!0,o.Login(e.username,e.pwd,function(t){t.token?(o.SetCredentials(e.username,t.token),e.dataLoading=!1,n.path("/timeline")):(e.error="Invalid credentials",e.dataLoading=!1)})}}]).directive("login",function(){return{restrict:"E",controller:"loginCtrl",templateUrl:"/main/webapp/app/js/modules/login/login.html"}}),angular.module("gabbler.translate",["pascalprecht.translate","ngCookies"]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/main/webapp/app/js/modules/languages/",suffix:".json"}),e.preferredLanguage("en")}]).controller("MainCtrl",["$scope","$translate",function(e,t){e.changeLanguage=function(e){t.use(e)}}]),angular.module("gabbler.menu",[]).directive("menu",function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"/main/webapp/app/js/modules/menu/menu.html"}}).controller("menuCtrl",["$scope","$cookieStore","$location","AuthenticationService",function(e,t,r,n){setInterval(function(){e.$apply(function(){var t=n.GetCredentials();e.nickname="undefined"==typeof t.currentUser?"":t.currentUser.username})},2e3),e.logout=function(){n.Logout(function(){})}}]),angular.module("gabbler.profile",[]).controller("profileCtrl",["$scope","$rootScope","$location","ProfileService","AuthenticationService",function(e,t,r,n){n.GetUserDatas("0",function(t){e.result=t,e.firstname=t.firstname,e.lastname=t.lastname,e.birthdate=new Date(t.birthdate),e.username=t.nickname,e.email=t.email}),e.updateProfile=function(){n.UpdateUserDatas("0",e.firstname,e.lastname,e.username,e.email,e.birthdate,function(t){t.success&&(e.result=t)})}}]),angular.module("gabbler.timeline",["gabbler.timeline.service"]).controller("profileOverviewCtrl",["$scope","$cookieStore","$location","AuthenticationService","TimelineServices",function(e,t,r,n,o){var a=null;e.token=t.get("globals").currentUser.token,o.GetProfilePreview("0",function(t){t.id&&(a=t,e.firstname=t.firstname,e.lastname=t.lastname,e.nickname=t.nickname,e.result=a.data)})}]).controller("timelineCtrl",["$scope","$cookieStore","$location","TimelineServices",function(e,t,r,n){e.gab;n.GetMyGabs(function(t){var r=t;for(var o in r)if(r.hasOwnProperty(o)){var a=new Date(1e3*r[o].postDate),i=a.getHours(),l="0"+a.getMinutes(),s="0"+a.getSeconds(),c=i+":"+l.substr(l.length-2)+":"+s.substr(s.length-2);e.date=c}n.GetProfilePreview(r[o].userId,function(t){e.username=t.nickname}),e.gabs=t}),e.addGab=function(){n.AddAGab(e.gab,function(t){0!==t.id&&n.GetMyGabs(function(t){e.gabs=t})})}}]).controller("suggestionsCtrl",["$scope","$cookieStore","$location",function(){}]),angular.module("gabbler.register",[]).controller("registerCtrl",["$scope","$rootScope","$location","RegisterService","AuthenticationService",function(e,t,r,n){e.register=function(){e.dataLoading=!0,e.error=e.gender+e.lastname+e.firstname+new Date(e.birthdate)+e.email+e.username+e.pwd,n.Register(e.gender,e.lastname,e.firstname,e.birthdate,e.email,e.username,e.pwd,function(t){t.success||(e.error=t.message,e.dataLoading=!1)})}}]).directive("register",function(){return{restrict:"E",templateUrl:"/main/webapp/app/js/modules/register/register.html"}}),angular.module("gabbler.profile.service",[]).factory("ProfileService",["$http","$cookieStore","$rootScope","$timeout",function(e,t){var r={};return r.GetUserDatas=function(r,n){var o=t.get("globals").currentUser.token;e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},"0"===r&&e.get("http://localhost:8082/gabbler/api/user/get?userId=2").success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},r.UpdateUserDatas=function(r,n,o,a,i,l,s){var c,u=t.get("globals").currentUser.token,g=new Date,p=new Date(l);"0"===r&&(c=2);var d={id:"2",displayName:"Utilisateur de test",email:i,nickname:a,birthdate:p,firstname:n,lastname:o,creationDate:g};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:u},e.post("http://localhost:8082/gabbler/api/user/update",d).success(function(e,t){s(e,t)}).error(function(e,t){s(e,t)})},r}]),angular.module("gabbler.login.service",[]).factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","$timeout",function(e,t,r,n){var o={};return o.Login=function(e,r,n){var o={password:r,username:e};t.post("http://localhost:8082/gabbler/api/login",o).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},o.Logout=function(e){var n={token:r.get("globals").currentUser.token},o={headers:{"Content-Type":"application/json"}};t.get("http://localhost:8082/gabbler/api/logout",o,n).success(function(t,r){e(t,r)}).error(function(t,r){e(t,r)})},o.SetCredentials=function(e,o){n.globals={currentUser:{username:e,token:o}},t.defaults.headers.common.Authorization="Basic "+o,r.put("globals",n.globals)},o.GetCredentials=function(){return r.get("globals")},o.ClearCredentials=function(){n.globals={},r.remove("globals"),r.remove("UserToken"),t.defaults.headers.common.Authorization="Basic "},o}]).factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var r,n,o,a,i,l="",s="",c="",u=0;do r=t.charCodeAt(u++),n=t.charCodeAt(u++),s=t.charCodeAt(u++),o=r>>2,a=(3&r)<<4|n>>4,i=(15&n)<<2|s>>6,c=63&s,isNaN(n)?i=c=64:isNaN(s)&&(c=64),l=l+e.charAt(o)+e.charAt(a)+e.charAt(i)+e.charAt(c),r=n=s="",o=a=i=c="";while(u<t.length);return l},decode:function(t){var r,n,o,a,i,l="",s="",c="",u=0,g=/[^A-Za-z0-9\+\/\=]/g;g.exec(t),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do o=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),i=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),r=o<<2|a>>4,n=(15&a)<<4|i>>2,s=(3&i)<<6|c,l+=String.fromCharCode(r),64!=i&&(l+=String.fromCharCode(n)),64!=c&&(l+=String.fromCharCode(s)),r=n=s="",o=a=i=c="";while(u<t.length);return l}}}),angular.module("gabbler.register.service",[]).factory("RegisterService",["$http","$cookieStore","$rootScope","$timeout",function(e){var t={};return t.Register=function(t,r,n,o,a,i,l,s){var c=new Date(o),u=new Date,g={password:l,displayName:i,nickname:i,birthdate:c,firstname:n,lastname:r,email:a,gender:t,creationDate:u};e.post("http://localhost:8082/gabbler/api/user/subscribe",g).success(function(e,t){s(e,t)}).error(function(e,t){s(e,t)})},t}]),angular.module("gabbler.timeline.service",[]).factory("TimelineServices",["$http","$cookieStore","$rootScope","$timeout",function(e,t){var r={};return r.GetProfilePreview=function(r,n){var o=t.get("globals").currentUser.token;e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o};"0"===r?e.get("http://localhost:8082/gabbler/api/user/get?userId=2").success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)}):"0"!==r&&e.get("http://localhost:8082/gabbler/api/user/get?userId="+r).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},r.AddAGab=function(r,n){var o=new Date,a=t.get("globals").currentUser.token,i={content:r,userId:2,postDate:o};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:a},e.post("http://localhost:8082/gabbler/api/gabs/publish",i).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},r.GetMyGabs=function(r){var n=t.get("globals").currentUser.token;e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:n},e.get("http://localhost:8082/gabbler/api/gabs/timeline/user?userId=2&startIndex=0&count=20").success(function(e,t){r(e,t)}).error(function(e,t){r(e,t)})},r}]);