var gabblerApp=angular.module("gabblerApp",["ngRoute","ngAnimate","gabbler.translate","gabbler.login.service","gabbler.menu","gabbler.login","gabbler.register.service","gabbler.register","gabbler.home","gabbler.timeline","gabbler.profile.service","gabbler.profile","toastr"]);gabblerApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"/main/webapp/app/js/modules/index/home.html",controller:"indexCtrl"}),e.when("/timeline/user",{templateUrl:"/main/webapp/app/js/modules/timeline/timeline.html"}),e.when("/profile",{templateUrl:"/main/webapp/app/js/modules/profile/profile.html",controller:"profileCtrl"})}]).run(["$http","$rootScope",function(e){e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"x-requested-with"}}]),angular.module("gabbler.home",["gabbler.menu","gabbler.login","gabbler.register"]).controller("indexCtrl",["$scope","AuthenticationService",function(e,t){e.pageClass="indexPageClass",t.ClearCredentials()}]),angular.module("gabbler.translate",["pascalprecht.translate","ngCookies"]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/main/webapp/app/js/modules/languages/",suffix:".json"}),e.preferredLanguage("en")}]).controller("MainCtrl",["$scope","$translate",function(e,t){e.changeLanguage=function(e){t.use(e)}}]),angular.module("gabbler.login",["toastr"]).controller("loginCtrl",["$scope","$rootScope","$cookieStore","$location","AuthenticationService","$route","toastr",function(e,t,r,o,n,a,i){e.login=function(){e.dataLoading=!0,n.Login(e.username,e.pwd,function(t){t.token?(e.dataLoading=!1,i.info(r.get("globals").currentUser.userID),o.path("/timeline/user")):(e.error="Invalid credentials",e.dataLoading=!1,i.error("Error while connecting ! "))})}}]).directive("login",function(){return{restrict:"E",controller:"loginCtrl",templateUrl:"/main/webapp/app/js/modules/login/login.html"}}),angular.module("gabbler.menu",["toastr"]).directive("menu",function(){return{restrict:"E",replace:!0,templateUrl:"/main/webapp/app/js/modules/menu/menu.html"}}).controller("menuCtrl",["$scope","$cookieStore","$location","AuthenticationService","toastr",function(e,t,r,o){setInterval(function(){e.$apply(function(){var t=o.GetCredentials();e.nickname="undefined"==typeof t?"":t.currentUser.username})},2e3),e.logout=function(){o.Logout(function(){})}}]),angular.module("gabbler.profile",["toastr"]).controller("profileCtrl",["$scope","$rootScope","$location","ProfileService","AuthenticationService","toastr",function(e,t,r,o,n,a){o.GetUserDatas(function(t){e.result=t,e.firstname=t.firstname,e.lastname=t.lastname,e.birthdate=new Date(t.birthdate),e.username=t.nickname,e.displayname=t.displayName,e.email=t.email}),e.updateProfile=function(){o.UpdateUserDatas(e.firstname,e.lastname,e.username,e.displayname,e.email,e.birthdate,function(t){t?(a.success("Your profile has been updated successfully !"),e.result=t,e.apply()):a.error("Error while update of your profile")})},e.updatePassword=function(){o.UpdatePassword(e.oldPassword,e.newPassword,function(e){e.success?a.info("Password has been successfully updated !"):e.error&&a.error("Error during update of your password","Please try again later")})}}]),angular.module("gabbler.register",["toastr"]).controller("registerCtrl",["$scope","$rootScope","$location","RegisterService","AuthenticationService","toastr",function(e,t,r,o,n,a){e.register=function(){e.dataLoading=!0,o.Register(e.gender,e.lastname,e.firstname,e.birthdate,e.email,e.username,e.pwd,function(t){t?n.Login(e.username,e.pwd,function(e){e?(a.info("Welcome To Gabbler !","Just Gab with your friends!"),r.path("/timeline/user")):a.error("Error while register, please retry again")}):(e.error=t.message,e.dataLoading=!1)})}}]).directive("register",function(){return{restrict:"E",templateUrl:"/main/webapp/app/js/modules/register/register.html"}}),angular.module("gabbler.timeline",["gabbler.timeline.service","toastr","ui.bootstrap"]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,r,o){var n=e(o.fileModel),a=n.assign;r.bind("change",function(){t.$apply(function(){a(t,r[0].files[0])})})}}}]).directive("fileModelBackground",["$parse",function(e){return{restrict:"A",link:function(t,r,o){var n=e(o.fileModelBackground),a=n.assign;r.bind("change",function(){t.$apply(function(){a(t,r[0].files[0])})})}}}]).controller("profileBackgroundCtrl",["$scope","$location","TimelineServices",function(e,t,r){e.profileBackGroundPicture=r.setBackgroundPicture();var o={};e.uploadFiles=function(){o=e.myFile,r.uploadPictureBackground(o,function(){e.profileBackGroundPicture=r.setBackgroundPicture()})}}]).controller("profileOverviewCtrl",["$scope","$cookieStore","$location","AuthenticationService","TimelineServices","toastr","$rootScope","$timeout",function(e,t,r,o,n,a){var i=null;e.token=t.get("globals").currentUser.token;t.get("globals").currentUser.userID;e.updated=0,n.GetProfilePreview(function(t){t&&(i=t,e.displayname=t.displayName,e.firstname=t.firstname,e.lastname=t.lastname,e.nickname=t.nickname,e.result=i.data,e.profilePicture=n.setProfilePicture())});var s="";e.uploadFiles=function(){s=e.myFile,a.info("file is "+JSON.stringify(s)),n.uploadFileToUrl(s,function(){e.profilePicture=n.setProfilePicture(),e.$broadcast("photoChanged")})}}]).controller("timelineCtrl",["$scope","$cookieStore","$location","TimelineServices","toastr","$rootScope",function(e,t,r,o,n){var a=(e.gab,t.get("globals").currentUser.userID,[]);o.GetMyGabs(function(t){var r=t;for(var n in r)if(r.hasOwnProperty(n)){var i=new Date(1e3*r[n].postDate),s=i.getHours(),l="0"+i.getMinutes(),c="0"+i.getSeconds(),u=s+":"+l.substr(l.length-2)+":"+c.substr(c.length-2);e.date=u,e.profilePicture=o.setProfilePicture()}setInterval(function(){e.$apply(function(){e.profilePicture=o.setProfilePicture()})},1e4),o.GetProfilePreview(function(t){e.username=t.nickname}),a=t,e.gabs=a}),e.addGab=function(){o.AddAGab(e.gab,function(t){t.id&&o.GetMyGabs(function(t){a=t,e.gabs=t})})},e.deleteGab=function(t,r){a.splice(t,1),e.gabs=a,o.DeleteGab(r,function(e,t){n.info(e+" "+t)})}}]).controller("suggestionsCtrl",["$scope","$cookieStore","$location",function(e){e.states=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Dakota","North Carolina","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]}]),angular.module("gabbler.login.service",["toastr"]).factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","$timeout","toastr",function(e,t,r,o,n,a){var i={};return i.Login=function(e,r,o){var n={password:r,username:e};t.post("http://localhost:8082/gabbler/api/login",n).success(function(t,r){i.SetCredentials(e,t.token,t.userID),a.info("Welcome To Gabbler !","Just Gab with your friends!"),a.success("You are now connected !"),o(t,r)}).error(function(e,t){a.error("Error while connecting !"),o(e,t)})},i.Logout=function(e){var o={token:r.get("globals").currentUser.token},n=r.get("globals").currentUser.token;t.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:n},t.get("http://localhost:8082/gabbler/api/logout",o).success(function(t,r){a.info("You have been disconnected !","Good Bye !"),e(t,r)}).error(function(t,r){a.info("You have been disconnected !","Good Bye !"),e(t,r)})},i.SetCredentials=function(e,n,a){o.globals={currentUser:{username:e,token:n,userID:a}},t.defaults.headers.common.Authorization="Basic "+n,r.put("globals",o.globals)},i.GetCredentials=function(){return r.get("globals")},i.ClearCredentials=function(){o.globals={},r.remove("globals"),r.remove("UserToken"),t.defaults.headers.common.Authorization="Basic "},i}]).factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var r,o,n,a,i,s="",l="",c="",u=0;do r=t.charCodeAt(u++),o=t.charCodeAt(u++),l=t.charCodeAt(u++),n=r>>2,a=(3&r)<<4|o>>4,i=(15&o)<<2|l>>6,c=63&l,isNaN(o)?i=c=64:isNaN(l)&&(c=64),s=s+e.charAt(n)+e.charAt(a)+e.charAt(i)+e.charAt(c),r=o=l="",n=a=i=c="";while(u<t.length);return s},decode:function(t){var r,o,n,a,i,s="",l="",c="",u=0,g=/[^A-Za-z0-9\+\/\=]/g;g.exec(t),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),i=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),r=n<<2|a>>4,o=(15&a)<<4|i>>2,l=(3&i)<<6|c,s+=String.fromCharCode(r),64!=i&&(s+=String.fromCharCode(o)),64!=c&&(s+=String.fromCharCode(l)),r=o=l="",n=a=i=c="";while(u<t.length);return s}}}),angular.module("gabbler.register.service",[]).factory("RegisterService",["$http","$cookieStore","$rootScope","$timeout",function(e){var t={};return t.Register=function(t,r,o,n,a,i,s,l){var c=new Date(n),u=new Date,g={password:s,displayName:i,nickname:i,birthdate:c,firstname:o,lastname:r,email:a,gender:t,creationDate:u};e.post("http://localhost:8082/gabbler/api/user/subscribe",g).success(function(e,t){l(e,t)}).error(function(e,t){l(e,t)})},t}]),angular.module("gabbler.profile.service",[]).factory("ProfileService",["$http","$cookieStore","$rootScope","$timeout",function(e,t){var r,o,n={};return n.GetUserDatas=function(n){r=t.get("globals").currentUser.token,o=t.get("globals").currentUser.userID,e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:r},"0"!==o&&e.get("http://localhost:8082/gabbler/api/user/get?userId="+o).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},n.UpdateUserDatas=function(n,a,i,s,l,c,u){r=t.get("globals").currentUser.token,o=t.get("globals").currentUser.userID;var g=new Date,p=new Date(c),d={id:o,email:l,nickname:i,birthdate:p,displayName:s,firstname:n,lastname:a,creationDate:g};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:r},e.post("http://localhost:8082/gabbler/api/user/update",d).success(function(e,t){u(e,t)}).error(function(e,t){u(e,t)})},n.UpdatePassword=function(o,n,a){r=t.get("globals").currentUser.token;var i={oldPassword:o,newPassword:n};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:r},e.post("http://localhost:8082/gabbler/api/user/password_change",i).success(function(e,t){a(e,t)}).error(function(e,t){a(e,t)})},n}]),angular.module("gabbler.timeline.service",[]).factory("TimelineServices",["$http","$cookieStore","$rootScope","$timeout",function(e,t){var r,o,n={};n.GetProfilePreview=function(n){r=t.get("globals").currentUser.token,o=t.get("globals").currentUser.userID,e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:r};o&&e.get("http://localhost:8082/gabbler/api/user/get?userId="+o).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},n.AddAGab=function(n,a){var i=new Date;r=t.get("globals").currentUser.token,o=t.get("globals").currentUser.userID;var s={content:n,userId:o,postDate:i};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:r},e.post("http://localhost:8082/gabbler/api/gabs/publish",s).success(function(e,t){a(e,t)}).error(function(e,t){a(e,t)})},n.DeleteGab=function(o,n){new Date;r=t.get("globals").currentUser.token,e.defaults.headers.delete={sessionAuthToken:r},e.delete("http://localhost:8082/gabbler/api/gabs/delete?gabsId="+o).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},n.GetMyGabs=function(r){var o=t.get("globals").currentUser.token,n=t.get("globals").currentUser.userID;e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},e.get("http://localhost:8082/gabbler/api/gabs/timeline/user?userId="+n+"&startIndex=0&count=20").success(function(e,t){r(e,t)}).error(function(e,t){r(e,t)})},n.uploadFileToUrl=function(o,n){r=t.get("globals").currentUser.token,e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:r};var a="http://localhost:8082/gabbler/api/user/picture/profile",i=new FormData;i.append("image",o),e.post(a,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})};var a={};return n.setProfilePicture=function(){var e;return e=(new Date).getTime(),a="http://localhost:8082/gabbler/api/user/picture/profile?userID="+o+"&timestamp="+e},n.uploadPictureBackground=function(o,n){r=t.get("globals").currentUser.token,e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:r};var a="http://localhost:8082/gabbler/api/user/picture/profile/background",i=new FormData;i.append("image",o),e.post(a,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},n.setBackgroundPicture=function(){o=t.get("globals").currentUser.userID;var e=(new Date).getTime();return a="http://localhost:8082/gabbler/api/user/picture/profile/background?userID="+o+"&timestamp="+e},n}]);