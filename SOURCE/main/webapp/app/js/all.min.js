var gabblerApp=angular.module("gabblerApp",["ngRoute","ngAnimate","gabbler.translate","gabbler.login.service","gabbler.menu","gabbler.login","gabbler.register.service","gabbler.register","gabbler.home","gabbler.timeline","gabbler.timeline.global","gabbler.profile.service","gabbler.profile","toastr"]);gabblerApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"/main/webapp/app/js/modules/index/home.html",controller:"indexCtrl"}),e.when("/timeline/user",{templateUrl:"/main/webapp/app/js/modules/timeline/timeline.html"}),e.when("/timeline",{templateUrl:"/main/webapp/app/js/modules/timeline_global/timeline_global.html"}),e.when("/profile",{templateUrl:"/main/webapp/app/js/modules/profile/profile.html",controller:"profileCtrl"})}]).run(["$http","$rootScope",function(e){e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"x-requested-with"}}]),angular.module("gabbler.home",["gabbler.menu","gabbler.login","gabbler.register"]).controller("indexCtrl",["$scope","AuthenticationService",function(e,t){e.pageClass="indexPageClass",t.ClearCredentials()}]),angular.module("gabbler.translate",["pascalprecht.translate","ngCookies"]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/main/webapp/app/js/modules/languages/",suffix:".json"}),e.preferredLanguage("en")}]).controller("MainCtrl",["$scope","$translate",function(e,t){e.changeLanguage=function(e){t.use(e)}}]),angular.module("gabbler.login",["toastr"]).controller("loginCtrl",["$scope","$rootScope","$cookieStore","$location","AuthenticationService","$route","toastr",function(e,t,o,r,n,a,i){e.login=function(){e.dataLoading=!0,n.Login(e.username,e.pwd,function(t){t.token?(e.dataLoading=!1,i.info(o.get("globals").currentUser.userID),r.path("/timeline/user")):(e.error="Invalid credentials",e.dataLoading=!1,i.error("Error while connecting ! "))})}}]).directive("login",function(){return{restrict:"E",controller:"loginCtrl",templateUrl:"/main/webapp/app/js/modules/login/login.html"}}),angular.module("gabbler.menu",["toastr"]).directive("menu",function(){return{restrict:"E",replace:!0,templateUrl:"/main/webapp/app/js/modules/menu/menu.html"}}).controller("menuCtrl",["$scope","$cookieStore","$location","AuthenticationService","toastr",function(e,t,o,r){setInterval(function(){e.$apply(function(){var t=r.GetCredentials();e.nickname="undefined"==typeof t?"":t.currentUser.username})},2e3),e.logout=function(){r.Logout(function(){})}}]),angular.module("gabbler.profile",["toastr"]).controller("profileCtrl",["$scope","$rootScope","$location","ProfileService","AuthenticationService","toastr",function(e,t,o,r,n,a){r.GetUserDatas(function(t){e.result=t,e.firstname=t.firstname,e.lastname=t.lastname,e.birthdate=new Date(t.birthdate),e.username=t.nickname,e.displayname=t.displayName,e.email=t.email}),e.updateProfile=function(){r.UpdateUserDatas(e.firstname,e.lastname,e.username,e.displayname,e.email,e.birthdate,function(t){t?(a.success("Your profile has been updated successfully !"),e.result=t,e.apply()):a.error("Error while update of your profile")})},e.updatePassword=function(){r.UpdatePassword(e.oldPassword,e.newPassword,function(e){e.success?a.info("Password has been successfully updated !"):e.error&&a.error("Error during update of your password","Please try again later")})}}]),angular.module("gabbler.register",["toastr"]).controller("registerCtrl",["$scope","$rootScope","$location","RegisterService","AuthenticationService","toastr",function(e,t,o,r,n,a){e.register=function(){e.dataLoading=!0,r.Register(e.gender,e.lastname,e.firstname,e.birthdate,e.email,e.username,e.pwd,function(t){t?n.Login(e.username,e.pwd,function(e){e?(a.info("Welcome To Gabbler !","Just Gab with your friends!"),o.path("/timeline/user")):a.error("Error while register, please retry again")}):(e.error=t.message,e.dataLoading=!1)})}}]).directive("register",function(){return{restrict:"E",templateUrl:"/main/webapp/app/js/modules/register/register.html"}}),angular.module("gabbler.timeline",["gabbler.timeline.service","toastr","ui.bootstrap"]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,o,r){var n=e(r.fileModel),a=n.assign;o.bind("change",function(){t.$apply(function(){a(t,o[0].files[0])})})}}}]).directive("fileModelBackground",["$parse",function(e){return{restrict:"A",link:function(t,o,r){var n=e(r.fileModelBackground),a=n.assign;o.bind("change",function(){t.$apply(function(){a(t,o[0].files[0])})})}}}]).controller("profileBackgroundCtrl",["$scope","$location","TimelineServices",function(e,t,o){e.profileBackGroundPicture=o.setBackgroundPicture();var r={};e.uploadFiles=function(){r=e.myFile,o.uploadPictureBackground(r,function(){e.profileBackGroundPicture=o.setBackgroundPicture()})}}]).controller("profileOverviewCtrl",["$scope","$cookieStore","$location","AuthenticationService","TimelineServices","toastr","$rootScope","$timeout",function(e,t,o,r,n,a){var i=null;e.token=t.get("globals").currentUser.token;t.get("globals").currentUser.userID;e.updated=0,n.GetProfilePreview(function(t){t&&(i=t,e.displayname=t.displayName,e.firstname=t.firstname,e.lastname=t.lastname,e.nickname=t.nickname,e.result=i.data,e.profilePicture=n.setProfilePicture())});var s="";e.uploadFiles=function(){s=e.myFile,a.info("file is "+JSON.stringify(s)),n.uploadFileToUrl(s,function(){e.profilePicture=n.setProfilePicture(),e.$broadcast("photoChanged")})}}]).controller("timelineCtrl",["$scope","$cookieStore","$location","TimelineServices","toastr","$rootScope",function(e,t,o,r,n){var a=(e.gab,t.get("globals").currentUser.userID,[]);r.GetMyGabs(function(t){var o=t;a=t,e.gabs=a,setInterval(function(){e.$apply(function(){for(var n in t)t.hasOwnProperty(n)&&(o[n].pictureProfile=r.setProfilePicture());e.gabs=t})},1e4),r.GetProfilePreview(function(t){e.username=t.nickname})}),e.addGab=function(){r.AddAGab(e.gab,function(t){t.id&&r.GetMyGabs(function(t){a=t,e.gabs=t})})},e.deleteGab=function(t,o){a.splice(t,1),e.gabs=a,r.DeleteGab(o,function(e,t){n.info(e+" "+t)})},e.states=["Like","Unlike"],e.likeOrUnlikeGab=function(t,o){e.gabs[t].btnLike.state===e.states[0]?r.LikeGab(o,function(i,s){200===s?(e.gabs[t].btnLike.state=e.states[1],r.GetMyGabs(function(t){a=t,e.gabs=a}),n.info("gab like "+t+" "+o)):n.error("error with the server")}):r.DislikeGab(o,function(i,s){200===s?(e.gabs[t].btnLike.state=e.states[0],r.GetMyGabs(function(t){a=t,e.gabs=a}),n.info("gab unlike"+t+" "+o)):n.error("error with the server")})}}]).controller("suggestionsCtrl",["$scope","$cookieStore","$location","TimelineServices","toastr",function(e,t,o,r,n){e.states=["Follow","UnFollow"],e.searchUser=function(){r.SearchUser(e.search,function(t,o){if(200===o){var r;r=t;for(var n in r)r.hasOwnProperty(n)&&(r[n].pictureProfile="http://localhost:8082/gabbler/api/user/picture/profile?userID="+r[n].id,r[n].btnFollow={state:e.states[0],index:n});e.result=r,e.btnState=e.states[0]}else e.result={}})},e.followOrUnfollowUser=function(t,o){n.info(e.result[t].btnFollow.state),e.result[t].btnFollow.state===e.states[0]?r.FollowUser(o,function(o,r){200===r?e.result[t].btnFollow.state=e.states[1]:n.error("error with the server")}):r.UnFollowUser(o,function(r,a){200===a?(e.result[t].btnFollow.state=e.states[0],n.info("user unfollowed"+t+" "+o)):n.error("error with the server")})}}]),angular.module("gabbler.timeline.global",["gabbler.timeline.service","toastr","ui.bootstrap"]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,o,r){var n=e(r.fileModel),a=n.assign;o.bind("change",function(){t.$apply(function(){a(t,o[0].files[0])})})}}}]).controller("profileOverviewGlobalCtrl",["$scope","$cookieStore","$location","AuthenticationService","TimelineServices","toastr","$rootScope","$timeout",function(e,t,o,r,n,a){var i=null;e.token=t.get("globals").currentUser.token;t.get("globals").currentUser.userID;e.updated=0,n.GetProfilePreview(function(t){t&&(i=t,e.firstname=t.firstname,e.lastname=t.lastname,e.nickname=t.nickname,e.result=i.data,e.profilePicture=n.setProfilePicture(),e.coverPicture=n.setBackgroundPicture())});var s="";e.uploadFiles=function(){s=e.myFile,a.info("file is "+JSON.stringify(s)),n.uploadFileToUrl(s,function(){e.profilePicture=n.setProfilePicture(),e.$broadcast("photoChanged")})}}]).controller("timelineGlobalCtrl",["$scope","$cookieStore","$location","TimelineServices","toastr","$rootScope",function(e,t,o,r,n){var a=(e.gab,t.get("globals").currentUser.userID,[]);e.states=["Like","Unlike"],r.GetGabsTimelineGlobal(function(t){e.gabs=t}),setInterval(function(){e.$apply(function(){r.GetGabsTimelineGlobal(function(t){e.gabs=t})})},1e4),e.addGab=function(){r.AddAGab(e.gab,function(t){t.id&&r.GetGabsTimelineGlobal(function(t){e.gabs=t})})},e.deleteGab=function(t,o){a.splice(t,1),e.gabs=a,r.DeleteGab(o,function(e,t){n.info(e+" "+t)})},e.likeOrUnlikeGab=function(t,o){e.gabs[t].btnLike.state===e.states[0]?r.LikeGab(o,function(r,a){200===a?(e.gabs[t].btnLike.state=e.states[1],n.info("gab like "+t+" "+o)):n.error("error with the server")}):r.DislikeGab(o,function(r,a){200===a?(e.gabs[t].btnLike.state=e.states[0],n.info("gab unlike"+t+" "+o)):n.error("error with the server")})}}]).controller("suggestionsGlobalCtrl",["$scope","$cookieStore","$location",function(e){e.states=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Dakota","North Carolina","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]}]),angular.module("gabbler.server.service",[]).factory("ServerLink",function(){var e,t={};return t.GetBaseUrlFromServer=function(){e="http://localhost:8082/gabbler/"},t.GetUrlEndpoint=function(){var e={loginUrl:"api/login"};return e},t}),angular.module("gabbler.profile.service",[]).factory("ProfileService",["$http","$cookieStore","$rootScope","$timeout",function(e,t){var o,r,n={};return n.GetUserDatas=function(n){o=t.get("globals").currentUser.token,r=t.get("globals").currentUser.userID,e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},"0"!==r&&e.get("http://localhost:8082/gabbler/api/user/get?userId="+r).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},n.UpdateUserDatas=function(n,a,i,s,l,c,u){o=t.get("globals").currentUser.token,r=t.get("globals").currentUser.userID;var p=new Date,g=new Date(c),f={id:r,email:l,nickname:i,birthdate:g,displayName:s,firstname:n,lastname:a,creationDate:p};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:o},e.post("http://localhost:8082/gabbler/api/user/update",f).success(function(e,t){u(e,t)}).error(function(e,t){u(e,t)})},n.UpdatePassword=function(r,n,a){o=t.get("globals").currentUser.token;var i={oldPassword:r,newPassword:n};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:o},e.post("http://localhost:8082/gabbler/api/user/password_change",i).success(function(e,t){a(e,t)}).error(function(e,t){a(e,t)})},n}]),angular.module("gabbler.login.service",["toastr"]).factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","$timeout","toastr",function(e,t,o,r,n,a){var i={};return i.Login=function(e,o,r){var n={password:o,username:e};t.post("http://localhost:8082/gabbler/api/login",n).success(function(t,o){i.SetCredentials(e,t.token,t.userID),a.info("Welcome To Gabbler !","Just Gab with your friends!"),a.success("You are now connected !"),r(t,o)}).error(function(e,t){a.error("Error while connecting !"),r(e,t)})},i.Logout=function(e){var r={token:o.get("globals").currentUser.token},n=o.get("globals").currentUser.token;t.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:n},t.get("http://localhost:8082/gabbler/api/logout",r).success(function(t,o){a.info("You have been disconnected !","Good Bye !"),e(t,o)}).error(function(t,o){a.info("You have been disconnected !","Good Bye !"),e(t,o)})},i.SetCredentials=function(e,n,a){r.globals={currentUser:{username:e,token:n,userID:a}},t.defaults.headers.common.Authorization="Basic "+n,o.put("globals",r.globals)},i.GetCredentials=function(){return o.get("globals")},i.ClearCredentials=function(){r.globals={},o.remove("globals"),o.remove("UserToken"),t.defaults.headers.common.Authorization="Basic "},i}]).factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var o,r,n,a,i,s="",l="",c="",u=0;do o=t.charCodeAt(u++),r=t.charCodeAt(u++),l=t.charCodeAt(u++),n=o>>2,a=(3&o)<<4|r>>4,i=(15&r)<<2|l>>6,c=63&l,isNaN(r)?i=c=64:isNaN(l)&&(c=64),s=s+e.charAt(n)+e.charAt(a)+e.charAt(i)+e.charAt(c),o=r=l="",n=a=i=c="";while(u<t.length);return s},decode:function(t){var o,r,n,a,i,s="",l="",c="",u=0,p=/[^A-Za-z0-9\+\/\=]/g;p.exec(t),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),i=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),o=n<<2|a>>4,r=(15&a)<<4|i>>2,l=(3&i)<<6|c,s+=String.fromCharCode(o),64!=i&&(s+=String.fromCharCode(r)),64!=c&&(s+=String.fromCharCode(l)),o=r=l="",n=a=i=c="";while(u<t.length);return s}}}),angular.module("gabbler.register.service",[]).factory("RegisterService",["$http","$cookieStore","$rootScope","$timeout",function(e){var t={};return t.Register=function(t,o,r,n,a,i,s,l){var c=new Date(n),u=new Date,p={password:s,displayName:i,nickname:i,birthdate:c,firstname:r,lastname:o,email:a,gender:t,creationDate:u};e.post("http://localhost:8082/gabbler/api/user/subscribe",p).success(function(e,t){l(e,t)}).error(function(e,t){l(e,t)})},t}]),angular.module("gabbler.timeline.service",[]).factory("TimelineServices",["$http","$cookieStore","$rootScope","$timeout",function(e,t){var o,r,n={};o=t.get("globals").currentUser.token,r=t.get("globals").currentUser.userID,n.GetProfilePreview=function(t){e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o};r&&e.get("http://localhost:8082/gabbler/api/user/get?userId="+r).success(function(e,o){t(e,o)}).error(function(e,o){t(e,o)})},n.AddAGab=function(n,a){var i=new Date;o=t.get("globals").currentUser.token,r=t.get("globals").currentUser.userID;var s={content:n,userId:r,postDate:i};e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Raw",sessionAuthToken:o},e.post("http://localhost:8082/gabbler/api/gabs/publish",s).success(function(e,t){a(e,t)}).error(function(e,t){a(e,t)})},n.DeleteGab=function(r,n){new Date;o=t.get("globals").currentUser.token,e.defaults.headers.delete={sessionAuthToken:o},e.delete("http://localhost:8082/gabbler/api/gabs/delete?gabsId="+r).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},n.GetMyGabs=function(o){var r=t.get("globals").currentUser.token,a=t.get("globals").currentUser.userID;e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:r},e.get("http://localhost:8082/gabbler/api/gabs/timeline/user?userId="+a+"&startIndex=0&count=20").success(function(e,t){var r=n.AddDatasToGabs(e);o(r,t)}).error(function(e,t){o(e,t)})},n.GetGabsTimelineGlobal=function(t){e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},e.get("http://localhost:8082/gabbler/api/gabs/timeline?startIndex=0&count=20").success(function(e,o){var r=n.AddDatasToGabs(e);t(r,o)}).error(function(e,o){t(e,o)})},n.AddDatasToGabs=function(e){var t=["Like","Unlike"],o=e;for(var n in o)if(o.hasOwnProperty(n)){o[n].pictureProfile="http://localhost:8082/gabbler/api/user/picture/profile?userID="+o[n].userId;var a=o[n].likers;if(0!==a.length)for(var i in a)a.hasOwnProperty(i)&&(o[n].btnLike=a[i].userID==r?{state:t[1],index:n}:{state:t[0],index:n});else o[n].btnLike={state:t[0],index:n}}return o},n.uploadFileToUrl=function(r,n){o=t.get("globals").currentUser.token,e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o};var a="http://localhost:8082/gabbler/api/user/picture/profile",i=new FormData;i.append("image",r),e.post(a,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})};var a={};return n.setProfilePicture=function(){var e;return e=(new Date).getTime(),a="http://localhost:8082/gabbler/api/user/picture/profile?userID="+r+"&timestamp="+e},n.uploadPictureBackground=function(r,n){o=t.get("globals").currentUser.token,e.defaults.headers.post={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o};var a="http://localhost:8082/gabbler/api/user/picture/profile/background",i=new FormData;i.append("image",r),e.post(a,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e,t){n(e,t)}).error(function(e,t){n(e,t)})},n.setBackgroundPicture=function(){r=t.get("globals").currentUser.userID;var e=(new Date).getTime();return a="http://localhost:8082/gabbler/api/user/picture/profile/background?userID="+r+"&timestamp="+e},n.SearchUser=function(t,r){e.defaults.headers.get={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},""!==t&&e.get("http://localhost:8082/gabbler/api/user/search?req="+t).success(function(e,t){r(e,t)}).error(function(e,t){r(e,t)})},n.FollowUser=function(t,r){e.defaults.headers.put={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},e.put("http://localhost:8082/gabbler/api/user/follow?userId="+t).success(function(e,t){r(e,t)}).error(function(e,t){r(e,t)})},n.UnFollowUser=function(t,r){e.defaults.headers.put={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},e.put("http://localhost:8082/gabbler/api/user/unfollow?userId="+t).success(function(e,t){r(e,t)}).error(function(e,t){r(e,t)})},n.LikeGab=function(t,r){e.defaults.headers.put={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},e.put("http://localhost:8082/gabbler/api/gabs/like?gabsId="+t).success(function(e,t){r(e,t)}).error(function(e,t){r(e,t)})},n.DislikeGab=function(t,r){e.defaults.headers.put={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*",sessionAuthToken:o},e.put("http://localhost:8082/gabbler/api/gabs/unlike?gabsId="+t).success(function(e,t){r(e,t)}).error(function(e,t){r(e,t)})},n}]);